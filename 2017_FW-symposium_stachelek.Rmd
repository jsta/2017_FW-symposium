---
author: Joseph Stachelek
title: "Phosphorus in 1,000s of Lakes"
subtitle: MSU Fisheries and Wildlife Symposium
date: "2017-02-24"
output:
  beamer_presentation:
    keep_tex: no
    theme: metropolis
    latex_engine: xelatex
    slide_level: 2
    incremental: no
    includes:
      in_header: header.tex
fontsize: 12pt
classoption: compress
---

```{r,setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE)
```

## Where do nutrients come from?

* Land-use

* Agriculture

## What is nutrient retention?

<!-- ### How much nutrients are present in lake outflow as a percentage of loadings? -->

\begincols
\begincol{0.4\textwidth}

* Buffering Capacity

* Nutrient Sensitivity

\endcol
\begincol{0.6\textwidth}
\center
\vspace{-2em}
\lakediagramblue
\lakediagramgreen

\endcol
\endcols

## Who cares about nutrient retention?

* Water quality

* CNH implications

* Nutrient/Ag regulations

< eutrophication picture >

## What do we know about nutrient retention?

## Previous studies on nutrient retention

\begincols
\begincol{0.5\textwidth}
```{r echo=FALSE, warning=FALSE, message=FALSE,eval=TRUE, fig.height=4.2, fig.width=4.6}
MRB1 <- read.csv("../../Dissertation/Analysis/nutrient_retention/milstead_2013.csv")
MRB1 <- MRB1[MRB1$hrt > 0,]
gg <- ggplot(MRB1, aes(x=hrt, y=1-Poutput/Pinput)) + geom_point(color = "grey") + scale_x_log10() + theme_classic() + xlab("Water Residence Time") + theme(axis.text.x = element_text(size = 16), axis.text = element_text(size = 16), axis.title = element_text(size = 16))

x <- log(MRB1$hrt)
y <- 1-MRB1$Poutput/MRB1$Pinput
y <- y[x > -Inf]
x <- x[x > -Inf]
dat <- data.frame(cbind(x, y))

fit <- nls(y~a/(1+exp(-b * (x-c))), start = list(a=1, b=0.3, c= .1))
# library(mgcv)
# fit <- mgcv::gam(y~s(x), data = dat)

dummy_x <- seq(0.000001, 100, by = 0.1)
preds <- predict(fit, data.frame(x = dummy_x))
# preds <- preds - min(preds)
preds <- data.frame(x = log(dummy_x), preds = as.numeric(preds))
# plot(preds$x, preds$preds, ylim = c(0,1))

gg #+ geom_line(data = preds, aes(x, preds)) + coord_cartesian(xlim = c(1e-6, 10), ylim = c(0, 1))

```

\endcol

\begincol{0.5\textwidth}

```{r brett_fig, eval=TRUE, echo=FALSE, fig.height=3.0, out.height="140pt"}
knitr::include_graphics("images/brett-2008_fig6.png")
```
\endcol
\endcols

## What is the mystery about nutrient retention?

### Unresolved questions about average retention and its geographical distribution

* Difficult to measure

* Previous studies limited to small numbers of lakes (w/ long residence times?)

* Milstead et al. (2013) found much less nutrient retention than previous studies. 

## Does shorter residence time explain the discrepancy?

### What is water residence time?

$$t_w=\frac{V_L}{Q}$$

```{r echo=FALSE, cache=TRUE, message=FALSE, warning=FALSE, fig.height=2.5, fig.width=5, out.width="200pt"}
library(ggplot2)
ggplot(MRB1, aes(x = hrt)) + geom_histogram() + scale_x_log10() + theme_classic() + ylab("Count") + xlab("Water Residence Time (y)") + coord_cartesian(xlim=c(1e-06,1)) + theme(axis.text.x = element_text(size = 16), axis.text = element_text(size = 16), axis.title = element_text(size = 16))

# hivolumerating <- as.numeric(MRB1$Volume > median(MRB1$Volume))
# hiflowrating   <- as.numeric(MRB1$FlowM3_yr > median(MRB1$FlowM3_yr))
# hiflowrating[hiflowrating == 0] <- 2
# hiflowrating[hiflowrating == 1] <- 4
# 
# rating <- hiflowrating + hivolumerating
# rating[rating == 3] <- "low"
# rating[rating == 4] <- "high"
# rating[rating == 2 | rating == 5] <- "medium"
# rating <- factor(rating, levels = c("low", "medium", "high"))
# 
# res <- matrix(table(rating) / nrow(MRB1), nrow = 2)
# row.names(res) <- c("low volume", "high volume")
# res <- data.frame(res)
# names(res) <- c("low flow", "high flow")

# plot(MRB1$Volume/MRB1$FlowM3_yr, MRB1$hrt, xlim = c(0, 100), ylim = c(0, 100))
```

## Is connectivity predictive of nutrient retention?

### What are lake connectivity classes?
<!-- http://cremeronline.com/LaTeX/minimaltikz.pdf -->
<!-- \draw [help lines] (0,3) grid (4,-3); -->

\connectivitydiagram


## What are my predictions?

\center
```{r predictions, eval=TRUE, echo=FALSE, fig.height=3.0, out.height="180pt"}
knitr::include_graphics("images/conceptual.png")
```


## What are my predictions?

\centering
\begin{tabularx}{\textwidth}{ l c| K{1.5cm} | C {1.5cm} | C{1.5cm} |}
\multicolumn{2}{c}{}
& \multicolumn{3}{c}{Connectivity} \\
\multirow{1}{*}{\rotatebox[origin=l]{90}{Water Residence Time}}\\
\multicolumn{2}{c}{}
 &  \multicolumn{1}{c}{High}
 &  \multicolumn{1}{c}{Medium}
 & \multicolumn{1}{c}{Low} \\
\cline{3-5}
& \rotatebox[origin=c]{90}{Low} & Low & &\\
\cline{3-5}
& \rotatebox[origin=c]{90}{Medium} & High & Medium &\\
\cline{3-5}
& \rotatebox[origin=c]{90}{High} & & High&\\
\cline{3-5}
\end{tabularx}


## How I will test my predictions

1. Calculate water residence time in 50,000 lakes

2. Calculate nutrient retention

3. Relate retention, residence time, and connectivity

## What are the implications of this work?

* Big picture

<!-- http://www.jpl.nasa.gov/spaceimages/images/largesize/PIA03434_hires.jpg -->

<!-- ## Using Blocks -->

<!-- Consider the example of three different block environments -->
<!-- are pre-defined and may be styled with an optional background color. -->

<!-- <!-- this sets the background -->
<!-- \metroset{block=fill}  -->

<!-- \begin{block}{Default} -->
<!--   Block content. -->
<!-- \end{block} -->

<!-- \begin{alertblock}{Alert} -->
<!--   Block content. -->
<!-- \end{alertblock} -->

<!-- \begin{exampleblock}{Example} -->
<!--   Block content. -->
<!-- \end{exampleblock} -->

<!-- ## What is SPARROW? -->

<!-- \pagecolor{white} -->

<!-- \center -->
<!-- ```{r sparrow, eval=TRUE, echo=FALSE, fig.height=3.0, out.height="180pt"} -->
<!-- knitr::include_graphics("images/sparrow.png") -->
<!-- ``` -->

<!-- * A spatial not temporal model (operates on mean annual values) -->

<!-- $$wq \sim land use + soils + precipitation + water velocity$$ -->

<!-- * base year is 2002 -->

<!-- ## What is LAGOS? -->

<!-- \center -->
<!-- ```{r lagos_fig, eval=TRUE, echo=FALSE, fig.height=3.0, out.height="180pt"} -->
<!-- knitr::include_graphics("images/lagos_study-extent.png") -->
<!-- ``` -->

<!-- * Approximately 50,000 lakes -->

